version: '3.8'

# This compose file is for BUILDING images locally before pushing to Docker Hub
# Use this on your development machine to build and tag images

services:
  # Backend API - Build from source
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: ${DOCKER_USERNAME}/${BACKEND_IMAGE_NAME}:${IMAGE_TAG}
    container_name: telegram_secrets_backend_build

  # Frontend - Build from source
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL}
        NEXT_PUBLIC_SITE_URL: ${NEXT_PUBLIC_SITE_URL}
        NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION: ${NEXT_PUBLIC_GOOGLE_SITE_VERIFICATION:-}
        NEXT_PUBLIC_YANDEX_VERIFICATION: ${NEXT_PUBLIC_YANDEX_VERIFICATION:-}
        NEXT_PUBLIC_BING_VERIFICATION: ${NEXT_PUBLIC_BING_VERIFICATION:-}
    image: ${DOCKER_USERNAME}/${FRONTEND_IMAGE_NAME}:${IMAGE_TAG}
    container_name: telegram_secrets_frontend_build
